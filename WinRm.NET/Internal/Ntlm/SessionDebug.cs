namespace WinRm.NET.Internal.Ntlm
{
    using System;
    using System.Text;
    using System.Threading.Tasks;
    using global::Kerberos.NET.Entities;

    public class SessionDebug
    {
        //private const string Negotiate = "TlRMTVNTUAABAAAAtYIIYgAAAAAAAAAAAAAAAAAAAAAKAPRlAAAADw==";
        //private const string Challenge = "TlRMTVNTUAACAAAAFAAUADgAAAA1goliqJMITb+s2ncAAAAAAAAAAKQApABMAAAACgB8TwAAAA9EAEEATgBWAE0AQwBMAE8AVQBEAAIAFABEAEEATgBWAE0AQwBMAE8AVQBEAAEAFABPAFAALQBBAEcARQBOAFQALQAyAAQAFgBkAGEAbgAuAHYAbQBjAGwAbwB1AGQAAwAsAG8AcAAtAGEAZwBlAG4AdAAtADIALgBkAGEAbgAuAHYAbQBjAGwAbwB1AGQABQAWAGQAYQBuAC4AdgBtAGMAbABvAHUAZAAHAAgAhuxgBljW2wEAAAAA";
        //private const string Authenticate_Me = "TlRMTVNTUAADAAAAGAAYAJAAAAD0APQAqAAAAAAAAABYAAAAKgAqAFgAAAAOAA4AggAAABAAEACcAQAANYKIYgoA9GUAAAAPZm410aHolN0dwLTZ6MGSXGMAYgBhAHQAdAAtAGEAZABtAEAARABBAE4ALgBWAE0AQwBMAE8AVQBEAEMATwBEAFkALQBQADIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVEfrmS7zF/k8k1ywPBwdGAEBAAAAAAAAhuxgBljW2wFjc5ZKhCc80gAAAAACABQARABBAE4AVgBNAEMATABPAFUARAABABQATwBQAC0AQQBHAEUATgBUAC0AMgAEABYAZABhAG4ALgB2AG0AYwBsAG8AdQBkAAMALABvAHAALQBhAGcAZQBuAHQALQAyAC4AZABhAG4ALgB2AG0AYwBsAG8AdQBkAAUAFgBkAGEAbgAuAHYAbQBjAGwAbwB1AGQABwAIAIbsYAZY1tsBBgAEAAIAAAAKABAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAADw0ZFMzvLvpukNTR3F+kSw=";
        //private const string Authenticate_Ms = "TlRMTVNTUAADAAAAGAAYAJAAAABeAV4BqAAAAAAAAABYAAAAKgAqAFgAAAAOAA4AggAAABAAEAAGAgAANYKI4goA9GUAAAAPHfSx5+yJRezCSrwSVhyy9WMAYgBhAHQAdAAtAGEAZABtAEAARABBAE4ALgBWAE0AQwBMAE8AVQBEAEMATwBEAFkALQBQADIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAiZofIA+WZ7j3XcOLg09YfQEBAAAAAAAAUwOpYFjW2wHzFw/jpE3XYwAAAAACABQARABBAE4AVgBNAEMATABPAFUARAABABQATwBQAC0AQQBHAEUATgBUAC0AMgAEABYAZABhAG4ALgB2AG0AYwBsAG8AdQBkAAMALABvAHAALQBhAGcAZQBuAHQALQAyAC4AZABhAG4ALgB2AG0AYwBsAG8AdQBkAAUAFgBkAGEAbgAuAHYAbQBjAGwAbwB1AGQABwAIAFMDqWBY1tsBBgAEAAIAAAAIADAAMAAAAAAAAAABAAAAACAAAFq+FR2C8qTxBm9L7nDMCpbpaJyx3FuPhN9aX8LWJTs0CgAQAAAAAAAAAAAAAAAAAAAAAAAJADYASABPAFMAVAAvAG8AcAAtAGEAZwBlAG4AdAAtADIALgBkAGEAbgAuAHYAbQBjAGwAbwB1AGQAAAAAAAAAAADRSVvuvILiEIr3pIYhopsr";
        //private const string Payload_Me = "1000000001000000588c76db1c424d8300000000d23201a654ec900d6b8cea2c3335fc61a6a53e9806bc98157179c5e96d3d84b0c119b2dab19796c554d99788b49cc37db1af32a80cd3d76a703ab914154646ece106fb0d937d1acc464f6daee3e9e92aa3006a25dab4e5dc0674a5c5f099ddd88af8dc23e369a10125d00267a050cf5613a78c48b2c071290d99c3dc0e3bad72e5dd04aebb76f983a6e6132ad52057536a2aeaadbb563fc27cb8944e509ffe6eb472b80b2d70ff9e6d05a081d61aaf6e21b480be858fbe7a0a98084030d52941f09c6018b86ae489f188433ec2ffaaaa2c722335d34a69ff58b1a5892fe51a5132c3a8c81e4fb9fed322ad1b58a8ceecaa0cb3ad07e6b8c57bd6f73f48bd6d03297863499b3bdee7408cdc1bf918a9c79f31699def9f989e3d53525274a4180e63ccbf43500fe9a791f2e3fbba8a02bec7d6c23a69a151ff16dfd31996d5c16cf05b2862915067616cd5686d0a0e127dae2c421f74ef7e1bc8b9ce8e67c63aa16f6a23ea199f63c6d732c20d7e78ebc29d4396b30f0472478f7f314ae2d8e6171beb16dbfa347db3d36c41b8f7f6fcef9d0e51f3a3339209c7ee12150faf3eec7e812c7b530da65f865ddf875797753802181108e45004d727c6e359909c0971d20ca6032d6f0de8ee82ebd818b7062915288dcbd1e64f32ef06451e6e81d3c173dcec577b8199c15ad9b1dc2cdafaecf02a05c997a7af96236cf2d3f66659f86654daa094157144c5ab769e9fc514d8d45b1870dd672832371e29a35d967ebc4b52edfcf1bcce43bbb99266bcd422bfae252b9ebf2f9e1605f285d88cb1e3a280ac08c7a042f181fff17c0fe0713434c795034275fde2b6b4ccd16f8924f69a9cf45b441f183194628c986e0730656f37fafc844d04a452ae448230bcb9712af9fe1bd92ef782aba58cff31b99710094bc257ab786c874cad7af81f839f490650af0505f537fa4b0062aecc4b95c382c7ca9ceb663f59b320b07a8df4ba0455b9bf6983c326e522d17b7da7dbe7f8c39a6bb900de9bb2b2921895fc9e980c1783cf980da9779074cf2a1e5d8e9446902a5a551eb831a582f797b7e48024ee408ee73b0b61200d52d548b4f8c6f75656f74fddf877f67df22426a88e725115ea1f0fa33b75f0b20838fc35a56a93127f5b848332c2d6cb57ad72a4258fd54de33eee220feabc13271685464686309fac2acdbbe307bf1f84c81ebdb548444785e1bf6358b2a3d11d8e1725b20bfccafb36c128e8f76a5d256dfd6419f5bdffdd077c4874a4266a33abc6b372fcbb4d8099acceee7fb21fddc35a54274d9d2a3dbc7c4b6582a8d98c85e749bf99105398e44a3a365efd69a888509ca53b0dcc72f190c650e49b3b271d42783942c291464b1818892fde43e2d010e28cc6e11cb1f4cadc4d7e126c48497fe02fbe1009ac0b0d8ab5480dde447f2ac8c8fc5e5c890898c79f5a6dcc075fdaaae40c2d22a4123d2bede543316bad88a4736fce4374c606562873052d1e322ac5abbdafabf202c065ffd81525616f4c33fac3c05dc0b072d87d8a241c36666d9be9b267eeefe5505e48377adc063ddc0ce61e4482984ad9349225792d31111d264044888ce3745aab6b8afd4bdd9bdb07dd81e51fc7cf646c469bfcd8524ec8131e1a85dea36f6847a2aa7d2ad84a405fa9f2f951dbec6382aadf35210d446ecf94a1d1eda12940a2fd9c2c7a17497010686490df2003491950d7fdb715e43f7a6806308b17de061e3a5ca5ebd2fa59ad70ff6e68f5d7a14f8488ffa608e2b50253a6847aebf39f60b4ecec9a8a203d92fa6145a687051db52ace37338dc48e79e581a0a55e2ae98dd970a2d8841432ecc270a8b96e7e3011bd182d7d649fa0309ce37a86a81bd584e8c335cc11d060d85dbd6e29332508d77efcd932d20f1ae7b00b50584b649d0be92735d19f45021eae7f36840d4bfa77f8093f3d5dd5c0ec2122af17d2759f4f326d8ce08fe888163323d6769672069eb92532bca75f28ef3c792e525e909bc7c0117370c6cd2aefda940fd5b7f94f981236dd43e91445450e001caa57b6a6106123202a";
        //private const string Payload_Ms = "1000000001000000bf2ba52b5ff8ea3f00000000ce7db7889b62fce101ce73e15a4754e1e2a68097af501397afeb1053ee454d3386795807aeb6b3eeb07772556c5aa4acc29eb464fb7a61d0ac13f58c93b185bf09b9a717fa6695e885df31f344f2f4f8eacb19eaa0764f6945e60484deaca70877f308beee574467a05faa1d0ec8334854ce6f4d29d7fb13e1054a9e8dc967c84f62d340a45e02a58ee42b1f210356f3ddea6b876412ee42b66883c0391dab7f09002d0efa0c38ad66bbca7579cded216538949b542da903ad07a46d5bed67c18cd64c5bd8f64adfa8d2d4eff3043ad53930cc24e994d3c12fd1de68fd4d0c6c48fa80420f8a3d7e28927ab09120c29da28ddf7b449762aee8d623cdf34c5b8b02849f927aeab9364c26af84578af6561527a3a69f19f7fba7461d19331267aea32f8aedd7cb6bdb48979de448184bd9df3167ffa65b593e991248f72e9f612444e3210d341c56f74638aa40f13827d16be7b5d2828ffdfa4757f0ac277ed743cd89bf4360ceea4d0224f45df70a08a8d64bdefe94c65ddde6ac96d9f6a9e94a5f2310c7c710411541c8111477119ef21e928f196b592686fc98b24a42a493851e4cd8477880d154a62dd0612b14d68c9b6b5a13fa2a1b2183593398016edbab143b9dde2824c608a5bf1057df8628d1a4003df2c5bfc9cc23d93c83944d58ad9b3a20e3a8467f2180af163d3025776ba029bd52a0d860ced206b3961f0c211199a9f7be15b5cf1e44813d018fbbf3ac89d63074f68a606ffe32d67476e7c7a2ebcb21c94faf685c881b9db6cb7491f8e07cc234b066fc4538aae8c0a05855031a3ec99ab7c7b28086645a14b9312fbce71c5906b268469bdaf84bb645605abeabb8d3a3c2771df475551f260e91359cf9a3dc9832971d06c7487cde4d6be74b7bb34c777cc09db88adc58fa9e230f3f3cdbcc57f9563bf9165bac0f893f2b04dcf1a25e2c35515776c9b6e449f7d7b3e27aaa808655b613746826925648bfe7940736e725daebd51e719f151c7f91b39ed9ec2f834d812db220ffea2a38a7c075111f3c05ef5f6726a4c28a2e11cb0cfc375345b2ca36e8c8d8ca4ed46c75579281d806650a34e958279f8c9f2425859c5e9b6435ffbeae03702d063706d05b74b5f777b7a3caeeb552d6e9eb0c1a38f19b2ce1a177c01e68138fb7cd9e27838927f348c603aa7ca4f8867b92ea5820f0011fc694db69a153c3995cb53aee7a6a593c875f51e95a9ea6af3372a11bcb0a29b1381a2e5f9fea71b5b20b61974160bae890c2dcf0e87b6ccd07260c7b9286bc398a2324b64683cbe0e2188b7fbc1223e35a5c06fc1d4693e465611b9a4ed882a0061b028f31d52d0ca94f29138f50582b1df9b039093cfc64c7df665e3354abc6aeb57b932bae5aab86004fa71124ed1b86469a633f1faac340fcc5424a3d3c345b993e227e7f865064e97f7b8c8b6d0e0c0b7c0a739821255c6c0c9c7c30df0cdd747168254a5d6c77c799e81fafad24e77fda03db220c39468b9f723730ab0d5918993f1e63d074f429aef3269f2d70d46732571e19ae311c7b4067ad59e5eb0a6c526683eec7e38536e80b1916e9247b09a99589ac77918bc9868448c618d351291f1f1f96a195daccdde62d0cae1e39d35d1f6ebab96fedd3d181adff22290af8b8a625073ada87f8f47e619834bd5b32dde0cadab13494e7840366f3ce82d42200a2f2df0ef2586eb121159ece15201d390c82059f0801128dfd02009b3818cc2bc7f32e88328ac29c5b00611f6ebe429cb20690d1ee4c75ade1abe4b21646198cf9d48faef95934ac78f152eb7abd6105529ebfa949aff4061d0d96983b5448737c271d600213d7fe4e1fde2767dd0aa072e0aecaef525fe2129989fff20f567c391642a9e3736c1b95283afcb5697a4d447e85f6600bc79f27c0ac2620cfdb08de1b2fdb3654ec0b287aedce2b28b4074ec976a48c7d8db6d7b0eaf7a28c446e3b60f632819716333bc63c880911c30adb8785ece1452d608d000782fc0042047abe00ece7f3a356cc0845a77726e54ce3644c2a30ddbf767e47d4a2f329a1a0452b1dbc48b5e1a18b11e1ebb71a46ca5e314c916d1fc72cc2115cc4d7fcb9d998103897d1e0fae4c84a3f466670f5cf68068b6c3b009bf8c6309037fa737384112925ac7a421b2440dbbffb6b37f11566b0159695e7adc2a98040f74b15653a9c94b749f39eded8c3b00844d4adef7cf5fcc159e907d80723012a0660d21b4048abf039f42b205521587541ea6e76fb684b6687d474d7c156f8a058cccd48c332c038d1ff1e932c77cbe68e6504e48354831e4f951e5a097766c38c974fe71f89f5bd541d55a571a27584a12b118d7393479315c528b23f946992380906d3e4f61cc1a2897faf41438fe41fe3e1872bb627a7572bb13719a21ba390620e905315d45b1ab4aaff5158a5ac67c497e376a265ec3bf916166a16dc8d6f471142c27f3076917684cd6e7f95ee8dbf8b7beb4bc718f732c3121350066e2e0cdce5637272a11a488ec903b515882301359d451455fc7994450dd3cdddc9b39ae59f9226cab52f5c0915aea0a4e2dc6900dc23448f3e73c0cc14abc93accd4f5fc260bf8b7c5b912bf9845b4d7f63979b9492372432daed995b754652547eaabde2fefbae0cc97342c498c6ca82d72ff4555a23db9d27354531e6297b425922a009fb7b8f0af3c9ebd265a65fe48886f4e2f36414688710a179ae4d85f41a167643ac32693ce2f9afff13cdb4feb6101a79b4fb675d630f853b744b18ab6b1047aef6de884478778fdb0d5b616a37eb4214cb60c02c18c0808c49276c26fd49785e6f20770a90584b6ea47bb78c60fb1187b942761a8c8009c877db4130bb36cc738ef3c5b8cee74e8ae2e25b1ef3c629531c5e7f3ce1de78b94b3d165794f7f6875627daa33a3eb0623a080b759bf11bc07df01a25fbe04b6fc4c357358209c408ee5d945487d689770c741dbb46ce3bf38917de5e105a22a4cac2b45f118c7b0c19f40f0728cf5025f0ebeaf2af836eaffff11fad5a407bbcbd88460b9292a722b67b19a44a0e1af2f0ffd5d6958fe973f04e340ee3b86fd56f66da9a195941765a139d2a155ca61e88489125903c170ba1bfe45f7e255ab0df9d9a39bd58c640f268b6cd68a450c9381dd451a79049e06c83af3f8cfe78f8281562ae20917cdfa3ed7fa07495176243e34d12c33da631a292eeaf286028d0899ea50fd2fc184934d708d573b65f7dd99ca79ef82526f56fee060b37b9badea15be6b72417790f4bcb3c7605cee80e93d927966d946c1fc51c9b5bed445bbb69493b826ba597e5debb228f84466b48a710c7603d81ea2d970dbc7f3c152ca4990fd030666540868e67222921c88786187b95ae5416bc8aee31d943a7efa479e5cb1cfc1adf111a2b80156b4feb39f368da04c3c848d546b3d4b90646cbd5dd46303127de4420604237c91620f3a6b77aabad42ecf49079edc4eb3a81be2120066f54a450f5d0785d5eab7752be0ce352ae10720723331dd5ff4ef1e4eaf05ba65faeb1afc16235795ce8985f3e2ff3d07c28fe71e2ac9cf167b0dc3a86769fdd9341da2da2b8c4dda9380af50f472dd6dd1cb0dc093eec6b8b6e7cdb86c53af996879dea798e7fe1cc0796819f941b64b084f9baaa47653f8dfab0ee490994298430c027a5c2d64e1a745ec9a3653ad9e62e6b7e7e6245f4db6a075bddf8985b6ae994f53213d253d4178d69e6e03aa01cf654ce78337f6c747839cfb613465f11e18f1ca0fb975dc6ea65d51e882d36fa4ceff9b8220267d4fa0bb0a53b819fb8ee2e022f456aff6b655eff12b052321b5ed75298ef0bc37c875ce5c87bed4829ea4450b3782d37ea0eeeb7fffe77bd5ae6f89726c6fafdb2eaf3d87a9486a29e3bb7608279f5df50001d3173de9b4887f32b53298cf096e2e00c583bba756007fe8860ae3146b435a2c32dacd2ee66faf98142154fd81ca9a6874692437eda4f5817bf0b110ea77b04634a9cc205f139f1c685c22d8cde32239c2ade86b56f6f1fcc6fa8ff52d392d7626c397f102d170fe1aea4bdb3ebc03c1a18cfe496fb2f3fde2e15333f94bb13642b0e0a73cb99fea4c6e13dfed40bb4efc69e716cc15a6b63591d6656d8c382a5b1b1db897b0ccbc57bc6546b118411e66427192c150a109f247c545e9f693fdd4a5e3dab222242711121931a7ec4119cab315874390f7e161ed6523c35a8a6c6f4722fa1a72f591cbd4f36ab5148d8b71f51766dcf6f4ecbff2effc79c62431e96d5ec63cbb490820094b8776d4ac48e247be0227446ef87d0eed22417b36ec3750d7540a8d951caea1f4badb58012f406f1c8d0863c5d129586c7afb0f361c6b2eec8ece03785f45d50a0da65a0ef9f12d175b16594ef962e22035b1a9accb9847d287ba003e9a054c3fe27b144cf11fbcdece83c8c64ab68f5c51a89ca22f9d962bda51e544c275982e29f15d7461ac3613e3d175ed5539d44c57f97fa9d4c439a958fb0e09324d664c1e4ca34817e747fce8a80c162c6bfd5ab964653b488f4327fc7df4cee2e6ca2b7e59d36a170fe424021db86ded79855b7aaed13386d8acabf1edf0643c06de5146c2a526ff9c4c071cc9b78528027f7fe996fa52e7f2ed3a7c2ceeb4d787d79b715d5ee847845ebe4bf4d5275687d6e79490ae580aee619161431e8adb1fa0131b8b81ce4648dca18547ce16b572a7d2f07cd048653d6bd6a4ed6314ebc29ff172bd411e7c1d5be1c975eca0b95c0b310eb0697548ecf316e7b2d1bd605e92a297d2c48ebec96546abc7bd0b534a12b462a84d3c6193bf9fdc5e661e40c8bada0ae7e515e726ab3ef15afa9a3201d16d6b3dba72b961a8b526074d97c5522602dd44cbff7ee45fa792f178777866ad76f9f4bad19ab12f8cd38dfc41ed2f4ba28586ca3a6962a3a51c728df9d4d43b6bb91b19322515730b77748b5c8d3bfe59af1fcc6050e4b99c859d99becd126e947eac6100389a125af2857c81f02ac19245623664bedef8e719f73e3017eba7e4c5f97aa98fb0fc6149c24990e8cdc229a02ffb69aae702fc5f6f738f803dd061bf03b5969b52fe304df11c41da9636b0b4a6128cf75e4ceb37d89ae1a1413328b2bd58cd616590ae329b8242fcaa9cc4d0f47744b5216f74bdc35c6dc23f84dc82dda64a6f31746245a3160fc59f2c8e7a51d1bbc685abc45a43d26ae9b0fac0db08a9b3088e875ab0d731b531c4402dcd93c65634ecf9ebdd0a1bb9e1cf8912c973eb222c95f31bf524a864a2c51b227d776adb37eaa7c26aa50d071f4e172d6ac0f6e02ed67e3755a3c5c0d0e5c012704de498a9cc55ca9c27289f58d4e9d4f32b036da17d8959156235e85c4a552a9f23981c7518007c5386a22ceff412c5359c80dc987e0744d5b675a9ae9a13d85b49c75d926d0f896d6b440439352974857624e858a064123538aec78f6727fab3152768010d846df1e3a77548ec350930c399cd19d6c9b5669bb863c90b62c0b1606fe6bea0b55930a2579caec32edd91f00fb53e1c192678a6a8f54c72bcf7a93d3c60a4ceb868ff1d148c86608c02e516ca000ccdb89284f7710196d7403e503a0b32c05148eeccb359011b1188129ab41af8eaf381ad2269c42247b1be416a4f5badaddd4e19c332220046d11ed19c3cf30d4d9e642f4b8f2ff96daf3c74f32f95058b44d1a4e298a1d5973cba31e68040e7b0f5257c41e9035ec7be5f98bf064c967860f3d85266fadc7e2bd81b400543d3b08d00eba2c5bd3a9fe6a5c49510cca3efc5d6f65340c7c792bda82a8b86656b246d94634c5c82792cafd7b73e8dfc3b7dfde788aa901efe2f9720e469ed196a9c7b32c08977d971caa2e953fcc4505125687249750eef3cfd7c461c7f1bbfcde9d39ebf8d964d55142be865967a707a640add0644b3f010bb0d1e20d8cddc5fb808a0e70cdcfd5d405ce8947aa50ea0c37588679ef750f0fb0e6e1853212ea7dc286f20e6ced23ad1d2d0f40a99cb74b6a85d6d7e75cf7a6d7f5a6f8bf27f5a2b4d436a5585ca7b0ace48ea670b9d10d9875b728ff9f35ac5e48fcf1730c5fdebe7c8083b7f5d50913582f257e785f5068b861fa912cd7cf7f9387f2898bf83ab06d857578788cac8964aa72f7767daefb74c2c202d0b7f6317efa14a87e27ad64e1eb3dfc8fa71d0024493de84e0b1233db1415e570fc23cb2316b38fb55eb8109d7274949a5ba81249e35839f5eaf5940df5c0208c766e67e5da4b291d18cb0bc1568ad25eebb2d8f46f32e08e95f0fa9ae991d6b2a030c270986b0a48d9b7ace10569d438b44fdf064d750e355bc8fad0078978712bd9158c4b97bd4ae9983074d7c1d71b2d747d28219be552a6a10d27555d99c7227d66866d3b1552ac100b4b4c4710d5246dbb89ae6308be09428e52793b5ddc00c7ffcce9279a6aeb7eac148adcf5b13f168084baeae87f11f9e4f788b1770987152d8bff6bbaa2c5a4b59a088247002ca5ac89275485093e6e82db09855c4a0817a8da03938a01f47f5d8f829bfd4c7a6180ce843c780421486fc28e2b952e5bfc532fcd4d87c72e24b546580df3f96fdede00c18be0f10ea1887850f29f6702fd34d4a7d2a417ca4eb5f267591d3376e9b3e65175f4766572d705d587a40e0c6fb7bd3b9b372b44fda2786ceefb7f3370fb99b24c83325ba978c91a701d8635fee60b2d4116f93005360aa3d89cb96039c62ef101b3a7b843d40fa6002a0b9d7ffc615347f37bbc700de710e22af83c9484b3d7597250b16bf28a6da70b3cb588f1309f36b8bb9d970f336e7b1fe53d42d6d1ae8aa9ce0270f4d6ecaa3e666d1fba49de2c9a697b1460e773db569daf07d03fa8a36a265b1d68bf8a2f0c8d71b515c247fee7898c9de12964b4114bb9efb9d6d741417d892bc5ad68b75024840888785c8d9fbbe33fc8a4efdd488369e77ea2e4ab8572472598cb6a8cc1597d1a447f87e286606b12de75e9dda876c61c666d5b2cac1a106142ca0ba5041a9520bf3767dfac35d5559afc3b098eab5385aeb4d6e5f5ad68198777d10115a2e7467f03053161bdbf5968abc9931a7c1d2f786b73990b62a201672f2ec5d1cfc05e6c89eb6a104931c88873addc85e4b291182e061d588815a0e44001617c87999ae4213a2210b19a7856efe78138588d42e76d7fe027acacea0c98a9a20510f3e00277fc93c941184bc54ec51ce8f4d003d0d5eb249c0bf0dcde78d50aad4920bd8cc8da6b2a150cf6e2853f6cb125de8a21357895c9f3e622a90600178abb5fd17b0c34d6774b1559272b57ee2ea8888aacc9072fb8876d5177909b79b99535a461214b5974b0861c72405dc0deefcd31f890de2d0a2c90ca3b7cb7db8975b686be66ea626581b1b948d76cc2c53841d1eb20636c0ad2282328868d3ea7bbe8fc6a8a94bb88ebcf1830cf8d213a95a5e295b40a1c147b43935894e89226ba6db63dcdb043257e4820795733553cfa49227b257ce5b4864c4f4b6ef624b3e1b201b75437c3f488f1ff8b4ad45a1043f4ee53934d6e78cc01571fba337558217f779f07ec9d410ac17a74bd5795b4e06be3e5f34fe64f146781f4fcde0be136d4344fe137b1589d1ce541f54d71dfacd0abfba698420391f0877131c7f7d5238f6b43ce2233cdc452298f3ac2d6bf8c5a1bfba6e911c916e11d988e310f1560545972513df5ae7c426eaa0104de244dcd228480c00b83a1e5abba55113efa5f152a90207bd763d87634d044afb7db778985d756ab68edc11d8d9d095552245d00eb4f6d607fa73a78fabe7daf7ddc895008f2993c178367d6e3f3a5e3c7ce3c2ad15d80e4b12f28129b15027b194cca5f0eedf441a7f501896a3cf968a70e85dd27cd80e0aed99aefa85048375e2d03def74bc8ef420852d536d213c12a4c080ac070367a3746d94498be1b5db69a068a16c73b2790aae05e407f20bcf3e3ace500addb7ae8805f3ed4743831d5270be65753dd91530e1a13a4a130e76fda8e08351a5e443a9e50008cbfef8c5af204e7b596bd4a36112ccd11d0ff4a734d8bd635adbea79f4d2db56c3b3f28ad5131af779f0cc5d3ddddaefed4d10b564c435d94aaa7bfc44a9917571d79545a1cec8aa5b7309aca660395481556493d0d1b1d4d6cf37f508d3ba7b1f6dc9402cfc0409d6ca7d0b282a00c5954541e5258efe811eb72ca5cf7f4f19590eac7a7c1d61cd6172b696a7d997cf9d1b334ce2ffe7d5758048192b099bca3f4370a335975d312880fde2ac6ae917723efb5e0df248c6a9096f948bf3f5f809445cb956cb79bde1931fe37e8f33aee73b0af4100ca4f02ab8000c2bbfcf5518f3dea12e4feaba44093b0d43e86bb0662ad4f0822934a4e6e6cd408ad8728746376a92b287cbc8ce0bfa6b90f46f02dde53da8a4dcf02ba9a5747cb8b8720848dfb43c476aa43936728b679c6873b8bc67d0c6f8cec92ddb97f2af38fb3b9d1023a78cf0340c236ddd56448ac56b90eb97c2e2041369e54d5692173ad545375df313a0e9af299593d99f6017eeea5178f9c4d06498455d1613d73e4b023522ffccf9adf536c53a655ab8423df0a6c1a4c418509e4d2158d9958312a948a32703736f2bb1ade573f3a5e6a8ff936eff2b94b0325d763153668be0255fa0dbe0119e50b1c51b6d7d2b8bcc7109222be81956e903f203ae44d824246cfab3fae22b17f5b6296df5260b3139c6621f285e5573b6a70af153a2a853cfa1e129e04660140fa1393221668f1fb5ebdc4eca1360fbbe9830f939b1a1fb2441025d17b3780bf74efa19076b7d21ebb33fbf929e554706fb3d8e41623f7ccdc36efaaf394ae55ff54b506365ab717423186d05d3c1149e2e02bcf2f8d7e938a5d04ec7ccc54b512a869d9d59c1360450f0e1380f80c32573ef1cc5ca405c9102ad144f732f56230404f5847a3386020da37f8494fe6a0cc758efda9663441de43b70816cac7debe91278ae382237c95e84bda7b31d5268dd23560d6607c6f5bd2d0882ff0849764fe04ec65a21a6b71fa9f99e5658aee422ec98e780133a31386a2e7b691626ddb5cf0410a05c17e98bb258dfaa82a93a36472de0fa882bbaa5594dde4856a5de0d72a24c2384b884650a0f50da44ab26975aaf0da2056c32d77d1297f5d7ea1d673e986daafcae2843364284d1cfec06f95acadbbabea08b1a54f68ac542a8bc896bcd431dd36434dda92f2be878178c92fbb23d4c92ffc9b4bda6f7ebc6fd9e379e3293dd9dbc633e00d8e51c189143e2f1e5fd228cef896cdd75fca53f1933e7e8110583ac1f4c9fade3d52fcfbb9e4b273d50b71133b1a75967b5f5a5e7b64160a27ca9731bdea5e0cdc925cbc483061c0ed162477af6638fcd980e8878b5b8bd43fc6be0853314e169d17db21f36f85f762aaca1bd76a9bdfe839ca68a1f762fadabf126ae95d899d33b3dbbd642df3e348ec28c7b596c443215364b61cb17b41e7c93d1674cff283772953e8bbea2c97f2789df08b3dd1943d0193cfaa6a324334a36ba029ec49d97aade3a6abd8bb72c5ca91ba1b13bb14a5a4c11ec228086d3d7de9887a2946523dd0103481a4f3bd7a3555f5d1d14a9c8067b5ab22c134419934ae371aa3b2538bbb1af042dca579f82feeaaff04097ebccfb113c15860c3a32e91cd4ec60db37059638725f352c4f73f2f2165e0da80f1ae6f34a8f88ce5fc7de7227b1d15514354b0f3e1fe77ea0da68f06f520a11c4e3c95e661a9ea22cb8b653496bc447920e25e222148b9518995f04f7ea3790eff31c7b03499f9030406d247f99f1ab2d281cc2d7903adb8ec41c8d8b5c19796a89f9f663cf3b558e17f03edd1b824813cf3cace0d3fef0a02d6435321be73f47c96f7c49031bd31e19416e04cc6ad1848746d035283e5ba5529c354995113ab921a8128636b628e61a9d2b56075e468ef5a947305e8f6e701a828df78c0e2195c3051a36a811ec0621e509d09009a8d4954fcc24ef786d42d6f5ec0df70ddb24f958be7d1e40c16ddd8fd14fce8e25b669cb9d70da6ca401d48bef01cfe156476a0bdb164c07efd74fd2776c52a5d045fb9eeebd8da4620e51d8e38757a7c3e120bfc2e6efd6a91e3d48ffe3dc8ca42fddc8aee1880374b7217468d674ef60621b4061a882e4667c34af59284cc83dbf150fcdfa02906485faa2619fce4829123b4dfff953031dcedfa2c73211324392acf7ba53630164dae33bb3c9d82de1152d918bdb15bfdaaede3c9e6e9d1c3d4a1338acfab0145f45b2f5564531d8ad65902a84a33d127e7667474085b84f2a22d889b50604c1e16085a4c7e7c7973ca68d7e7b29ebebd5aa6e27322148e495e0966a4a6ad8e29bd3ce";
        //private const string Password = "root4EDMZ";

        public static Task Debug(string b64Authenticate, string password, ReadOnlyMemory<byte> payload)
        {
            var authenticateMessage = Convert.FromBase64String(b64Authenticate);
            var authenticate = new NtlmAuthenticate(authenticateMessage);
            var credentials = new Credentials(authenticate.UserName, authenticate.DomainName, password);
            var responseKeyNt = NtlmCrypto.ResponseKeyNt(credentials);

            ReadOnlyMemory<byte> challengeFromClient;
            NtChallengeResponse ntChallengeResponse;
            if (authenticate.NtChallengeResponse.Length > 0x0018)
            {
                ntChallengeResponse = new NtChallengeResponse(authenticate.NtChallengeResponse);
                challengeFromClient = ntChallengeResponse.ClientChallenge.ChallengeFromClient;
            }
            else
            {
                throw new InvalidOperationException("Only NTLMv2 is supported.");
            }

            var ntProofStr = ntChallengeResponse.NtProofStr;
            var sessionBaseKey = NtlmCrypto.SessionBaseKey(responseKeyNt, ntProofStr);
            var kexkey = NtlmCrypto.KXKEY(authenticate.NegotiationFlags, sessionBaseKey);

            ReadOnlyMemory<byte> exportedSessionKey;
            if (authenticate.NegotiationFlags.HasFlag(NtlmNegotiateFlag.NTLMSSP_NEGOTIATE_KEY_EXCH) &&
                (authenticate.NegotiationFlags.HasFlag(NtlmNegotiateFlag.NTLMSSP_NEGOTIATE_SIGN) ||
                 authenticate.NegotiationFlags.HasFlag(NtlmNegotiateFlag.NTLMSSP_NEGOTIATE_SEAL)))
            {
                exportedSessionKey = NtlmCrypto.RC4KRandomSessionKey(kexkey, authenticate.EncryptedRandomSessionKey);
            }
            else
            {
                throw new InvalidDataException("Only signed / sealed messages are supported");
            }

            var clientSealingKey = NtlmCrypto.ComputeKey(exportedSessionKey, client: true, signing: false);
            var clientSigningKey = NtlmCrypto.ComputeKey(exportedSessionKey, client: true, signing: true);

            var serverSealingKey = NtlmCrypto.ComputeKey(exportedSessionKey, client: false, signing: false);
            var serverSigningKey = NtlmCrypto.ComputeKey(exportedSessionKey, client: false, signing: true);

            Console.WriteLine($"session key: {Convert.ToHexString(exportedSessionKey.Span)}");
            Console.WriteLine($"client sign: {Convert.ToHexString(clientSigningKey.Span)}");
            Console.WriteLine($"server sign: {Convert.ToHexString(serverSigningKey.Span)}");
            Console.WriteLine($"client seal: {Convert.ToHexString(clientSealingKey.Span)}");
            Console.WriteLine($"server seal: {Convert.ToHexString(serverSealingKey.Span)}");

            var encryptor = new NtlmEncryptor(clientSealingKey, serverSealingKey, clientSigningKey, serverSigningKey);
            var headerLength = BitConverter.ToInt32(payload.Span);
            var headerBytes = payload.Slice(4, headerLength);
            ReadOnlySpan<byte> stuffToDecrypt = payload.Slice(4 + headerLength).Span;
            Console.WriteLine($"decrypting: {stuffToDecrypt.Slice(0, 10).ToHexString()} ... {stuffToDecrypt.Slice(stuffToDecrypt.Length - 10).ToHexString()}");
            var decrypted = encryptor.Client.Transform(stuffToDecrypt);
            var str = Encoding.UTF8.GetString(decrypted.Span);
            Console.WriteLine(str);

            return Task.CompletedTask;
        }
    }
}
